# Exodus Database Schema - Standardized

## Core Tables

**Purpose**: User management, profile configuration, and core business entities that users directly manage.

### users
**Purpose**: Stores user account information and AI configuration preferences.  
**User Interaction**: Read, Update - users can view and update their profiles (account creation/deletion handled by admin).  
**Endpoints Needed**: ✅ Read, Update

```sql
users {
  id: uuid (primary key)
  email: varchar(255) (unique, not null)
  first_name: varchar(100)
  last_name: varchar(100)
  
  -- AI Configuration
  finetuned_model_name: varchar(255)
  creative_mode_model: varchar(255)
  creative_mode_temperature: decimal(3,2) (default 0.77)
  creative_mode_top_p: decimal(3,2) (default 0.98)
  default_mode: varchar(20) (default 'creative') -- creative/reasoning
  system_prompt: text
  
  -- Integration URLs
  google_drive_folder_url: text
  slack_channel_url: text
  metric_tracking_spreadsheet_url: text
  
  -- Content Configuration
  default_target_audience: text
  news_filter_prompt: text
  rss_bundle_id: varchar(255)
  telegram_chat_id: varchar(255)
  
  created_at: timestamp (default now())
  updated_at: timestamp (default now())
}
```

### audiences
**Purpose**: User-defined audience segments for content targeting.  
**User Interaction**: Full CRUD - users create, edit, and delete their audience segments.  
**Endpoints Needed**: ✅ Create, Read, Update, Delete

```sql
audiences {
  id: uuid (primary key)
  user_id: uuid (foreign key -> users.id, not null)
  audience_name: varchar(255) (not null)
  audience_description: text
  created_at: timestamp (default now())
  updated_at: timestamp (default now())
}
```

### products
**Purpose**: User's product catalog for promotion in generated content.  
**User Interaction**: Full CRUD - users manage their product listings.  
**Endpoints Needed**: ✅ Create, Read, Update, Delete

```sql
products {
  id: uuid (primary key)
  user_id: uuid (foreign key -> users.id, not null)
  product_name: varchar(255) (not null)
  product_price: decimal(10,2)
  product_description: text
  product_link: text
  created_at: timestamp (default now())
  updated_at: timestamp (default now())
}
```

## Content Tables

**Purpose**: Generated content management and performance tracking.

### content
**Purpose**: Stores AI-generated content (emails, ads, scripts) with metadata and generation status.  
**User Interaction**: Read, Update, Delete - users can edit generated content, star favorites, mark as used.  
**Endpoints Needed**: ✅ Read, Update, Delete (creation happens via generation process)

```sql
content {
  id: uuid (primary key)
  user_id: uuid (foreign key -> users.id, not null)
  
  -- Generated Content
  subject_line: text
  subject_line_ideas: text -- alternative subject lines
  content_text: text
  content_type: varchar(50) (default 'email') -- email, ad, script, etc
  
  -- Content Metadata
  idea_title: varchar(500)
  idea_description: text
  user_perspective: text
  
  -- Generation Status
  status: varchar(20) (default 'writing') -- writing, error, done
  stage: varchar(20) (default 'draft') -- draft, complete
  content_inspiration_type: varchar(50) -- news, scraped, coaching, daily_question
  
  -- Optional Relationships
  target_audience_id: uuid (foreign key -> audiences.id, nullable)
  product_id: uuid (foreign key -> products.id, nullable)
  news_idea_id: uuid (foreign key -> news_ideas.id, nullable)
  coaching_call_id: uuid (foreign key -> coaching_calls.id, nullable)
  feed_content_id: uuid (foreign key -> feed_content.id, nullable)
  tracked_stats_id: uuid (foreign key -> content_stats.id, nullable)
  
  is_starred: boolean (default false)
  is_used: boolean (default false)
  created_at: timestamp (default now())
  updated_at: timestamp (default now())
}
```

### content_stats
**Purpose**: Tracks performance metrics for published content (opens, clicks, revenue).  
**User Interaction**: Read-only - automatically populated by external email/marketing systems.  
**Endpoints Needed**: ❌ Auto-populated, no user interaction needed

```sql
content_stats {
  id: uuid (primary key)
  content_id: uuid (foreign key -> content.id, not null)
  
  -- Email Metrics
  total_sends: integer (default 0)
  open_rate: decimal(5,2)
  click_rate: decimal(5,2)
  click_to_open_rate: decimal(5,2)
  bounces: integer (default 0)
  unsubscribes: integer (default 0)
  num_replies: integer (default 0)
  
  -- Business Metrics
  revenue: decimal(10,2)
  
  -- Timing
  date_sent: timestamp
  created_at: timestamp (default now())
  updated_at: timestamp (default now())
}
```

## Source Management Tables

**Purpose**: Content feed configuration and subscription management for efficient multi-user scraping.

### content_feeds
**Purpose**: Master list of content sources (TikTok accounts, YouTube channels, blogs) that can be monitored.  
**User Interaction**: Full CRUD - users add/remove feeds they want to monitor.  
**Endpoints Needed**: ✅ Create, Read, Update, Delete

```sql
content_feeds {
  id: uuid (primary key)
  source_type: varchar(50) (not null) -- youtube, tiktok, blog, twitter, etc
  source_title: varchar(255)
  profile_link: text
  
  created_at: timestamp (default now())
  updated_at: timestamp (default now())
}
```

### user_feed_subscriptions
**Purpose**: Links users to content feeds, enabling efficient multi-user scraping without duplication.  
**User Interaction**: Create/Delete subscriptions - users subscribe/unsubscribe from feeds.  
**Endpoints Needed**: ✅ Create, Delete (Read handled via feed listings)

```sql
user_feed_subscriptions {
  id: uuid (primary key)
  user_id: uuid (foreign key -> users.id, not null)
  feed_id: uuid (foreign key -> content_feeds.id, not null)
  is_active: boolean (default true)
  
  created_at: timestamp (default now())
  
  UNIQUE(user_id, feed_id)
}
```

### feed_content
**Purpose**: Content scraped from monitored feeds, automatically populated by scraping system.  
**User Interaction**: Read-only for inspiration - users can star/mark as used for content generation.  
**Endpoints Needed**: ❌ Auto-populated by scrapers, users interact via content generation interface

```sql
feed_content {
  id: uuid (primary key)
  feed_id: uuid (foreign key -> content_feeds.id, not null)
  
  -- RSS/External IDs
  rss_bundle_id: varchar(255)
  rss_author_id: varchar(255)
  rss_feed_id: varchar(255)
  
  -- Content Data
  feed_title: varchar(500)
  feed_content_text: text
  content_summary: text
  content_analysis: text
  
  -- Source Attribution
  author_name: varchar(255)
  original_link: text
  image_url: text
  
  -- Engagement Metrics
  views_count: bigint (default 0)
  likes_count: integer (default 0)
  bookmarks_count: integer (default 0)
  comments_count: integer (default 0)
  shares_count: integer (default 0)
  followers_count: integer (default 0)
  
  -- Performance Score (calculated)
  performance_score: decimal(10,2)
  
  -- Timestamps
  published_at: timestamp
  feed_scraped_at: timestamp (default now())
  created_at: timestamp (default now())
  
  is_starred: boolean (default false)
  is_used: boolean (default false)
}
```

## News System Tables

**Purpose**: Automated news monitoring and idea generation system with predefined sources.

### news_urls
**Purpose**: Hardcoded list of news sources and topics for automated monitoring.  
**User Interaction**: None - system-managed news source configuration.  
**Endpoints Needed**: ❌ Hardcoded configuration, no user interaction

```sql
news_urls {
  id: uuid (primary key)
  topic_name: varchar(255)
  scrape_url: text (not null)
  url_type: varchar(50)
  is_active: boolean (default true)
  created_at: timestamp (default now())
}
```

### user_news_subscriptions
**Purpose**: Manages which news topics/sources each user wants to receive ideas from.  
**User Interaction**: Subscribe/unsubscribe from news categories in user preferences.  
**Endpoints Needed**: ✅ Create, Delete (managed via user preferences interface)

```sql
user_news_subscriptions {
  id: uuid (primary key)
  user_id: uuid (foreign key -> users.id, not null)
  news_url_id: uuid (foreign key -> news_urls.id, not null)
  is_active: boolean (default true)
  
  created_at: timestamp (default now())
  
  UNIQUE(user_id, news_url_id)
}
```

### top_news
**Purpose**: Internal storage for scraped news articles, not directly visible to users.  
**User Interaction**: None - backend data for generating news ideas.  
**Endpoints Needed**: ❌ Internal scraping data, no user interaction

```sql
top_news {
  id: uuid (primary key)
  news_url_id: uuid (foreign key -> news_urls.id, not null)
  
  article_title: varchar(500)
  article_content: text
  article_summary: text
  publication_name: varchar(255)
  topic_name: varchar(255)
  article_link: text
  image_url: text
  
  published_at: timestamp
  scraped_at: timestamp (default now())
  created_at: timestamp (default now())
}
```

### news_ideas
**Purpose**: AI-generated content ideas based on news articles, personalized for each user.  
**User Interaction**: Read, Update, Delete - users can star, mark as used, delete, and generate content from ideas.  
**Endpoints Needed**: ✅ Read, Update, Delete (auto-populated, users manage via actions)

```sql
news_ideas {
  id: uuid (primary key)
  user_id: uuid (foreign key -> users.id, not null)
  top_news_id: uuid (foreign key -> top_news.id, not null)
  
  idea_title: varchar(500)
  idea_description: text
  user_perspective: text
  article_title: varchar(500)
  image_url: text
  
  is_starred: boolean (default false)
  is_used: boolean (default false)
  created_at: timestamp (default now())
}
```

## User Input Tables

**Purpose**: Content automatically captured from user activities (Telegram responses, coaching calls).

### daily_questions
**Purpose**: User responses to daily questions via Telegram, automatically captured for content inspiration.  
**User Interaction**: Read, Update, Delete - users can star, mark as used, delete, and generate content from Q&As.  
**Endpoints Needed**: ✅ Read, Update, Delete (auto-populated via Telegram integration)

```sql
daily_questions {
  id: uuid (primary key)
  user_id: uuid (foreign key -> users.id, not null)
  
  question_text: text
  answer_text: text
  question_type: varchar(50)
  
  is_starred: boolean (default false)
  is_used: boolean (default false)
  created_at: timestamp (default now())
}
```

### coaching_calls
**Purpose**: Transcribed and analyzed coaching calls, automatically processed for content extraction.  
**User Interaction**: Read, Update, Delete - users can star, mark as used, delete, and generate content from call insights.  
**Endpoints Needed**: ✅ Read, Update, Delete (auto-populated via call processing system)

```sql
coaching_calls {
  id: uuid (primary key)
  user_id: uuid (foreign key -> users.id, not null)
  
  call_title: varchar(255)
  transcript_url: text
  transcript_text: text
  core_focus: text
  call_summary: text
  call_notes: text
  
  call_date: timestamp
  is_starred: boolean (default false)
  is_used: boolean (default false)
  created_at: timestamp (default now())
}
```

## AI Suggestions Table

**Purpose**: System-generated content suggestions based on analysis of user's inspiration sources.

### suggested_ideas
**Purpose**: AI-generated content suggestions that connect multiple inspiration sources for enhanced ideas.  
**User Interaction**: Read, Update, Delete - users can star, mark as used, delete, and generate content from suggestions.  
**Endpoints Needed**: ✅ Read, Update, Delete (auto-populated by AI analysis system)

```sql
suggested_ideas {
  id: uuid (primary key)
  user_id: uuid (foreign key -> users.id, not null)
  
  idea_title: varchar(500)
  idea_description: text
  suggestion_reasoning: text
  source_type: varchar(50) -- news, scraped, daily_question, coaching
  
  -- Source Links (nullable, only one should be set)
  news_idea_id: uuid (foreign key -> news_ideas.id, nullable)
  feed_content_id: uuid (foreign key -> feed_content.id, nullable)
  daily_question_id: uuid (foreign key -> daily_questions.id, nullable)
  coaching_call_id: uuid (foreign key -> coaching_calls.id, nullable)
  
  is_starred: boolean (default false)
  is_used: boolean (default false)
  created_at: timestamp (default now())
}
```

## Indexes for Performance

```sql
-- User lookups
CREATE INDEX idx_users_email ON users(email);

-- Content queries
CREATE INDEX idx_content_user_status ON content(user_id, status);
CREATE INDEX idx_content_user_starred ON content(user_id, is_starred);
CREATE INDEX idx_content_user_type ON content(user_id, content_type);
CREATE INDEX idx_content_created_at ON content(created_at DESC);

-- Source content
CREATE INDEX idx_feed_content_feed ON feed_content(feed_id);
CREATE INDEX idx_feed_content_published ON feed_content(published_at DESC);

-- News system
CREATE INDEX idx_news_ideas_user ON news_ideas(user_id);
CREATE INDEX idx_top_news_topic ON top_news(topic_name);

-- User content
CREATE INDEX idx_daily_questions_user ON daily_questions(user_id);
CREATE INDEX idx_coaching_calls_user ON coaching_calls(user_id);
```