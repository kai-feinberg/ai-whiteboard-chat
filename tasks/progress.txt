## Progress Log

### 2026-01-22: US-DOC-001 - Documents Schema
- Added `documents` table to `convex/schema.ts`
- Fields: organizationId, title, content (markdown), createdAt, updatedAt, createdBy
- Indexes: by_organization, by_organization_updated
- Note: Pre-existing TS errors in codebase unrelated to this change. Convex codegen passes.

### 2026-01-22: US-DOC-002 - Documents CRUD Functions
- Created `convex/documents/functions.ts` with 5 functions:
  - `createDocument` - mutation, creates doc with title/content
  - `getDocument` - query, fetches single doc, validates org ownership
  - `listMyDocuments` - query, returns all org docs sorted by updatedAt desc
  - `updateDocument` - mutation, updates title/content, sets updatedAt
  - `deleteDocument` - mutation, removes doc, validates org ownership
- All functions verify auth and organizationId
- Uses `by_organization_updated` index for sorted listing
- Patterns match `convex/canvas/functions.ts`
- Convex codegen passes. Logic review passed.

### 2026-01-22: US-DOC-003 - Documents List Page
- Created `src/routes/documents/index.tsx`:
  - Route `/documents` with `beforeLoad` auth guard
  - Lists org documents with title, last updated date
  - "New Document" button creates and navigates to editor
  - Delete button with confirmation dialog
  - Empty state with icon and CTA button
  - Loading state with skeleton cards
- Modified `src/components/app-sidebar.tsx`:
  - Added "Documents" link with FileText icon
- Browser testing passed: all acceptance criteria verified
- Note: Pre-existing TS errors in codebase unrelated to this change

### 2026-01-22: US-DOC-004 - Document Editor Page
- Created `src/routes/documents/$documentId.tsx`:
  - Route `/documents/$documentId` with `beforeLoad` auth guard
  - Editable title field - auto-saves on blur
  - Large textarea for content - debounced auto-save (1s delay)
  - "Saved" / "Saving..." indicator in header
  - Back button navigates to /documents list
  - Loading state with spinner
  - 404 handling when document doesn't exist (Convex validates ID format)
- Fixed race conditions from logic review:
  - Uses refs (lastSavedContentRef, lastSavedTitleRef) to compare against last saved value
  - Tracks pendingSavesRef to avoid premature "saved" status
  - Toast notifications on save errors
- Browser testing passed: title editing, content auto-save, "Saved" indicator all working
- Next: US-LR-001 (readLink AI tool)
