High-Level Architecture Overview
Data Storage
State Management:

Nodes and edges are managed using React Flow's useNodesState and useEdgesState hooks
These hooks provide proper state management with built-in change handlers that React Flow uses internally for dragging, positioning, and connections
Persistence:

State is saved to localStorage under the key "whiteboard-state"
On mount, the app loads saved nodes and edges from localStorage
Whenever nodes or edges change, the state is automatically saved back to localStorage
Node Data Structure: Each node has:

id: Unique identifier (e.g., "text-1234567890" or "chat-1234567890")
type: Either "textNode" or "chatNode"
position: {x, y} coordinates on the canvas
data: Type-specific data object containing:

label: Display name
handles: Configuration for connection points ({target: boolean, source: boolean})
Type-specific fields (e.g., content for text nodes, messages for chat nodes)
Rendering System
Node Types Mapping:

The nodeTypes object maps type strings to React components
Each node type receives the full node object (id, data, etc.) as props
Node components use AI Elements compound components: <Node>, <NodeHeader>, <NodeTitle>, <NodeContent>, <NodeFooter>, <Toolbar>
Canvas Rendering:

The <Canvas> component (from AI Elements) wraps React Flow
It receives the nodes array, edges array, and type mappings
React Flow handles the actual rendering, positioning, dragging, and connection drawing
The canvas is infinite and supports panning/zooming
Connection System
How Connections Work:

Each node has handles (connection points) defined in its data
Users drag from a source handle to a target handle to create connections
The onConnect callback receives the connection and uses React Flow's addEdge helper to add it to the edges array
Edges are stored separately from nodes and reference node IDs
Context Awareness:

Chat nodes can query connected text nodes via getConnectedTextNodes(chatNodeId)
This function filters edges to find incoming connections, then retrieves the content from connected text nodes
The aggregated context is passed to the AI API when sending messages

Worked for 25s
3:07 PM

## AI Elements Components Architecture

### **What AI Elements Provides**

AI Elements is a wrapper layer around React Flow that provides pre-styled, workflow-optimized components. It handles the complex React Flow setup and provides a cleaner API for building node-based interfaces.

---

### **Core Components & Their Responsibilities**

**1. Canvas Component**

- **Wraps**: React Flow's `<ReactFlow>` component
- **Handles**:

- Infinite canvas with pan and zoom
- Background grid rendering
- Default interaction settings (pan on middle/right mouse, disable selection-on-drag for connections)
- Delete key handling (Backspace/Delete to remove nodes)
- Built-in Controls component integration



- **Configuration**: Pre-configured with sensible defaults for workflow UIs (fitView, panOnScroll, etc.)


**2. Node Component (Compound Component Pattern)**

- **Wraps**: shadcn Card component + React Flow Handle components
- **Handles**:

- Visual node container with consistent styling
- Automatic handle (connection point) rendering based on configuration
- Positions handles on left (target) and right (source) sides



- **Sub-components**:

- `NodeHeader`: Styled header with secondary background and border
- `NodeTitle`: Title text styling
- `NodeDescription`: Subtitle/description text
- `NodeContent`: Main content area with padding
- `NodeFooter`: Footer section with border
- `NodeAction`: Action buttons/controls



- **Benefits**: Provides a consistent, card-based UI pattern for all node types


**3. Edge Component**

- **Wraps**: React Flow's `BaseEdge` with custom path calculations
- **Handles**:

- Two edge variants: `Animated` and `Temporary`
- **Animated**: Bezier curves with animated circle traveling along the path
- **Temporary**: Dashed lines for temporary/preview connections
- Automatic handle position calculation and path drawing



- **Smart Positioning**: Calculates exact handle coordinates considering node position and handle dimensions


**4. Connection Component**

- **Wraps**: React Flow's connection line rendering
- **Handles**:

- Visual feedback while dragging to create connections
- Draws a curved bezier path from source to cursor position
- Shows a circle indicator at the cursor end
- Uses CSS variables for theming (var(--color-ring))





**5. Controls Component**

- **Wraps**: React Flow's built-in controls
- **Handles**:

- Zoom in/out buttons
- Fit view button
- Interactive controls panel
- Positioned in bottom-left corner by default





---

### **What AI Elements Abstracts Away**

**React Flow Complexity:**

- Manual handle positioning and styling
- Connection line rendering logic
- Edge path calculations (bezier curves, handle offsets)
- Default interaction configurations
- Background and controls setup


**Styling Consistency:**

- Pre-styled components that match shadcn design system
- Consistent spacing, borders, and colors
- Responsive and accessible by default


**Boilerplate Code:**

- No need to manually create handle components
- No need to calculate edge paths
- No need to configure React Flow props repeatedly


---

### **How It Integrates with React Flow**

AI Elements doesn't replace React Flowâ€”it enhances it:

- Still uses React Flow's state management (`useNodesState`, `useEdgesState`)
- Still uses React Flow's callbacks (`onConnect`, `onNodesChange`, `onEdgesChange`)
- Still uses React Flow's helper functions (`addEdge`)
- The Canvas component passes all props through to ReactFlow, so you can use any React Flow feature


The key benefit is that AI Elements provides a **higher-level, opinionated API** that makes it faster to build workflow UIs while maintaining full React Flow flexibility underneath.